name: ci-test

on: 
  push:
      branches: ["main"]
      
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
       
      - uses: actions/checkout@v3


      - name: build
        id: test
        run: |
          "::notice:: sample"
          write-output "sample=this is me" >> $env:GITHUB_OUTPUT
          $items=gci -recurse -file

          "::notice:: convert to json"
          $arr=($($items.fullname)|convertto-json).Replace('\\n','\n')

          "::notice:: arr"
          $arr

          "::notice::set output"
          write-output "data=$($arr)" >> $env:GITHUB_OUTPUT

          "::notice::set env"
          write-output "TEST_DATA=$($arr)" >> $env:GITHUB_ENV
        shell: pwsh

      - name: test-var
        run: |

          $items=('${{ steps.test.outputs.data }}'|convertfrom-json)

          "${{ steps.test.outputs.sample }}"|convertfrom-json

          $items

          write-host $items
          
        shell: pwsh


      - name: debug
        if: always()
        run: |
            gci env: | select name,value
            Write-host "ref: ${{ github.ref }}"
        shell: pwsh  

    